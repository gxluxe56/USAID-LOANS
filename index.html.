<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USAID LOAN ¬∑ 2‚Äëpage demo</title>
    <style>
        * { box-sizing: border-box; font-family: system-ui, 'Segoe UI', Roboto, sans-serif; margin: 0; }
        body { background: #f0f4f8; display: flex; flex-direction: column; align-items: center; padding: 1rem; }
        .page { max-width: 800px; width: 100%; }
        h1 { font-size: 2.2rem; font-weight: 600; letter-spacing: -0.5px; color: #0b2b4f; border-left: 6px solid #da291c; padding-left: 1rem; margin: 0.5rem 0 1rem; }
        .card { background: white; border-radius: 24px; padding: 1.5rem 2rem; margin-bottom: 2rem; box-shadow: 0 12px 30px rgba(0,0,0,0.05); border: 1px solid #e6edf4; }
        .flex-row { display: flex; gap: 1rem; flex-wrap: wrap; align-items: center; }
        label { font-size: 0.9rem; font-weight: 500; color: #1a3a5f; }
        input, select { background: #f9fcff; border: 1px solid #bdc9d6; border-radius: 40px; padding: 0.6rem 1.2rem; font-size: 0.95rem; width: auto; flex: 1 1 180px; transition: 0.2s; }
        input:focus, select:focus { border-color: #0b2b4f; outline: none; background: white; }
        .calc-output { background: #e3eef9; border-radius: 40px; padding: 0.6rem 1.5rem; font-weight: 600; color: #0f3b5e; }
        hr { margin: 1.5rem 0 1rem; border: 1px solid #dde5ed; }
        .step-indicator { background: #e9f0f6; border-radius: 60px; padding: 0.5rem 1.2rem; display: inline-block; font-weight: 600; margin-bottom: 1.5rem; }
        .btn-group { display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem; }
        button { background: #0b2b4f; border: none; color: white; padding: 0.7rem 2rem; border-radius: 60px; font-weight: 600; font-size: 1rem; cursor: pointer; transition: 0.2s; border: 1px solid #0b2b4f; }
        button:hover { background: #133f66; }
        button:disabled { opacity: 0.4; }
        #prevBtn { background: white; color: #0b2b4f; border: 1px solid #7f9ab3; }
        #prevBtn:hover { background: #e3eef9; }
        .summary-box { background: #f4fafd; border-radius: 24px; padding: 1.5rem; border-left: 4px solid #da291c; margin: 1.5rem 0; }
        .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.8rem; }
        .feed-item { background: #f4f9ff; border-radius: 20px; padding: 1rem 1.5rem; margin-bottom: 0.8rem; border: 1px solid #cbdae7; font-size: 0.9rem; }
        .feed-ref { color: #b32d1e; font-weight: 700; letter-spacing: 0.3px; }
        #modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); display: none; align-items: center; justify-content: center; }
        .modal-content { background: white; max-width: 400px; padding: 2rem; border-radius: 40px; text-align: center; box-shadow: 0 30px 40px #00000020; }
        .modal-content h3 { font-size: 2rem; color: #0b2b4f; margin: 0.5rem 0; }
        .ref-number { background: #1d4a76; color: white; font-size: 1.6rem; padding: 0.5rem 1.5rem; border-radius: 80px; letter-spacing: 2px; margin: 1rem 0; font-weight: 700; }
        .close-btn { background: white; color: #0b2b4f; border: 2px solid #0b2b4f; margin-top: 1rem; }
    </style>
</head>
<body>
<div class="page">
    <h1>üá∫üá∏ USAID LOAN</h1>

    <!-- LANDING PAGE ¬∑ calculator (page 1) -->
    <div class="card">
        <h2 style="margin-top:0; color:#1f3d62;">üìä loan calculator</h2>
        <div class="flex-row">
            <label>amount ($): <input type="number" id="calcAmount" value="1000" min="100" step="100"></label>
            <label>term (months): <select id="calcTerm">
                <option value="6">6 months</option>
                <option value="12" selected>12 months</option>
                <option value="18">18 months</option>
                <option value="24">24 months</option>
            </select></label>
        </div>
        <p class="calc-output" style="display: inline-block; margin-top: 1rem;">monthly payment: $<span id="calcPayment">91.68</span></p>
        <p style="color:#48647f; font-size:0.85rem; margin-top:0.5rem;">* based on 18.12% APR (fixed rate example)</p>
    </div>

    <!-- APPLICATION ¬∑ multi‚Äëstep form (page 2) -->
    <div class="card">
        <h2 style="color:#1f3d62;">üìã application form</h2>
        <div class="step-indicator" id="stepIndicator">Step 1 / 3</div>

        <!-- STEP 1 -->
        <div id="step1">
            <h3>üîπ step 1: loan details</h3>
            <label>loan type:</label>
            <select id="loanType" style="width:100%; margin-bottom:1rem;">
                <option value="Home Loan" selected>üè† Home Loan</option>
                <option value="Personal Loan">Personal Loan</option>
                <option value="Business Loan">Business Loan</option>
            </select>
            <div class="flex-row">
                <label>amount ($): <input type="number" id="loanAmount" value="1000" min="500"></label>
                <label>term: <select id="loanTerm">
                    <option value="6" selected>6 months</option>
                    <option value="12">12 months</option>
                    <option value="18">18 months</option>
                </select></label>
            </div>
        </div>

        <!-- STEP 2 -->
        <div id="step2" style="display:none;">
            <h3>üîπ step 2: personal info</h3>
            <label>full name:</label>
            <input type="text" id="fullName" placeholder="e.g. Jean Malela" style="width:100%; margin-bottom:1rem;">
            <label>email:</label>
            <input type="email" id="email" placeholder="name@example.com" style="width:100%; margin-bottom:1rem;">
            <label>DRC phone (+243):</label>
            <input type="tel" id="phone" value="+243" placeholder="+243 81 234 5678" style="width:100%;">
        </div>

        <!-- STEP 3 -->
        <div id="step3" style="display:none;">
            <h3>üîπ step 3: employment & review</h3>
            <label>employment status:</label>
            <select id="empStatus" style="width:100%; margin-bottom:1rem;">
                <option value="Employed">Employed</option>
                <option value="Self-employed">Self-employed</option>
                <option value="Unemployed">Unemployed</option>
            </select>
            <label>annual income ($):</label>
            <input type="number" id="income" value="24000" min="0" step="1000" style="width:100%;">

            <!-- summary card -->
            <div class="summary-box">
                <strong>üìå summary</strong>
                <div class="summary-grid" id="summaryContent" style="margin-top:0.8rem;">
                    <span>type:</span><span id="sumLoanType">Home Loan</span>
                    <span>amount/term:</span><span id="sumAmountTerm">$1000 / 6 mo</span>
                    <span>name:</span><span id="sumName">‚Äî</span>
                    <span>email:</span><span id="sumEmail">‚Äî</span>
                    <span>phone:</span><span id="sumPhone">+243</span>
                    <span>employment:</span><span id="sumEmp">Employed</span>
                    <span>income:</span><span id="sumIncome">$24000</span>
                </div>
            </div>
        </div>

        <!-- navigation buttons -->
        <div class="btn-group">
            <button id="prevBtn" onclick="prevStep()" style="display:none;">‚Üê Previous</button>
            <button id="nextBtn" onclick="nextStep()">Next ‚Üí</button>
            <button id="submitBtn" onclick="submitApplication()" style="display:none;">‚úì submit</button>
        </div>
    </div>

    <!-- OWNER AREA: live feed of submitted applications -->
    <div class="card">
        <h2 style="color:#1f3d62;">üëÅÔ∏è owner feed ‚Äì submissions</h2>
        <div id="submissionsFeed">
            <div class="feed-item" style="color:#718096;">no data yet ‚Äì submit an application</div>
        </div>
        <p style="font-size:0.8rem; margin-top:0.5rem;">üîê every submission appears here (owner view)</p>
    </div>
</div>

<!-- CONFIRMATION MODAL -->
<div id="modal">
    <div class="modal-content">
        <h3>‚úÖ submitted</h3>
        <div class="ref-number" id="modalRef">INN‚Äë658031</div>
        <p>your application is saved</p>
        <button class="close-btn" onclick="closeModal()">close</button>
    </div>
</div>

<script>
    // ----- GLOBALS -----
    let currentStep = 1;
    const submissions = [];    // owner feed data

    // references
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const step3 = document.getElementById('step3');
    const stepInd = document.getElementById('stepIndicator');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const submitBtn = document.getElementById('submitBtn');
    const modal = document.getElementById('modal');
    const modalRef = document.getElementById('modalRef');

    // form fields
    const loanType = document.getElementById('loanType');
    const loanAmount = document.getElementById('loanAmount');
    const loanTerm = document.getElementById('loanTerm');
    const fullName = document.getElementById('fullName');
    const email = document.getElementById('email');
    const phone = document.getElementById('phone');
    const empStatus = document.getElementById('empStatus');
    const income = document.getElementById('income');

    // summary spans
    const sumLoanType = document.getElementById('sumLoanType');
    const sumAmountTerm = document.getElementById('sumAmountTerm');
    const sumName = document.getElementById('sumName');
    const sumEmail = document.getElementById('sumEmail');
    const sumPhone = document.getElementById('sumPhone');
    const sumEmp = document.getElementById('sumEmp');
    const sumIncome = document.getElementById('sumIncome');

    // ----- LANDING CALCULATOR (fixed r = 0.0151 ‚âà 18.12% APR) -----
    function updateCalc() {
        const amount = parseFloat(document.getElementById('calcAmount').value) || 1000;
        const term = parseInt(document.getElementById('calcTerm').value) || 12;
        const r = 0.0151; // monthly rate that yields 91.68 for 1000/12
        if (amount > 0 && term > 0) {
            const pow = Math.pow(1 + r, term);
            const payment = (amount * r * pow) / (pow - 1);
            document.getElementById('calcPayment').innerText = payment.toFixed(2);
        } else {
            document.getElementById('calcPayment').innerText = '91.68';
        }
    }
    document.getElementById('calcAmount').addEventListener('input', updateCalc);
    document.getElementById('calcTerm').addEventListener('change', updateCalc);
    updateCalc();

    // ----- STEP CONTROL -----
    function showStep(step) {
        step1.style.display = step === 1 ? 'block' : 'none';
        step2.style.display = step === 2 ? 'block' : 'none';
        step3.style.display = step === 3 ? 'block' : 'none';
        stepInd.innerText = `Step ${step} / 3`;

        // button visibility
        prevBtn.style.display = step > 1 ? 'inline-block' : 'none';
        if (step === 3) {
            nextBtn.style.display = 'none';
            submitBtn.style.display = 'inline-block';
        } else {
            nextBtn.style.display = 'inline-block';
            submitBtn.style.display = 'none';
        }

        if (step === 3) updateSummary();  // refresh summary
    }

    // validation helpers
    function validateStep1() {
        if (!loanType.value) return false;
        const amt = parseFloat(loanAmount.value);
        if (isNaN(amt) || amt < 500) { alert('minimum loan amount is $500'); return false; }
        return true;
    }
    function validateStep2() {
        if (!fullName.value.trim()) { alert('enter full name'); return false; }
        if (!email.value.includes('@') || !email.value.includes('.')) { alert('valid email required'); return false; }
        if (!phone.value.startsWith('+243')) { alert('phone must start with +243 (DRC)'); return false; }
        return true;
    }

    // navigation
    window.nextStep = function() {
        if (currentStep === 1 && !validateStep1()) return;
        if (currentStep === 2 && !validateStep2()) return;
        if (currentStep < 3) {
            currentStep++;
            showStep(currentStep);
        }
    };
    window.prevStep = function() {
        if (currentStep > 1) {
            currentStep--;
            showStep(currentStep);
        }
    };

    // summary builder (step3)
    function updateSummary() {
        sumLoanType.innerText = loanType.value;
        const amt = parseFloat(loanAmount.value) || 1000;
        const term = loanTerm.options[loanTerm.selectedIndex]?.value || '6';
        sumAmountTerm.innerText = `$${amt} / ${term} mo`;
        sumName.innerText = fullName.value.trim() || '‚Äî';
        sumEmail.innerText = email.value.trim() || '‚Äî';
        sumPhone.innerText = phone.value.trim() || '+243';
        sumEmp.innerText = empStatus.options[empStatus.selectedIndex]?.text || 'Employed';
        sumIncome.innerText = `$${parseFloat(income.value) || 0}`;
    }

    // submit ‚Äì push to owner feed, show modal, reset form
    window.submitApplication = function() {
        // validate step3 fields (income)
        if (!income.value || parseFloat(income.value) < 0) { alert('enter a valid annual income'); return; }
        if (!fullName.value.trim()) { alert('name missing in step2'); currentStep = 2; showStep(2); return; }

        // generate reference (unique based on counter)
        const refBase = 'INN-658031';
        const refNumber = submissions.length === 0 ? refBase : refBase + '-' + String(submissions.length + 1).padStart(3, '0');

        // build submission object
        const submission = {
            ref: refNumber,
            loanType: loanType.value,
            amount: parseFloat(loanAmount.value) || 1000,
            term: loanTerm.value,
            name: fullName.value.trim(),
            email: email.value.trim(),
            phone: phone.value.trim(),
            empStatus: empStatus.value,
            income: parseFloat(income.value) || 0,
            timestamp: new Date().toLocaleString()
        };
        submissions.push(submission);

        // update owner feed
        const feedDiv = document.getElementById('submissionsFeed');
        feedDiv.innerHTML = submissions.map(s => `
            <div class="feed-item">
                <span class="feed-ref">${s.ref}</span> ¬∑ ${s.name}<br>
                <span style="color:#2b577f;">${s.loanType} $${s.amount} (${s.term}mo) ¬∑ ${s.email} ¬∑ ${s.phone}<br>
                emp: ${s.empStatus}, income $${s.income} ¬∑ ${s.timestamp}</span>
            </div>
        `).join('') || '<div class="feed-item">no submissions</div>';

        // show modal with reference
        modalRef.innerText = refNumber;
        modal.style.display = 'flex';

        // reset form to default (owner feed keeps old entries)
        loanType.value = 'Home Loan';
        loanAmount.value = '1000';
        loanTerm.value = '6';
        fullName.value = '';
        email.value = '';
        phone.value = '+243';
        empStatus.value = 'Employed';
        income.value = '24000';
        currentStep = 1;
        showStep(1);
    };

    window.closeModal = function() {
        modal.style.display = 'none';
    };
    window.onclick = function(e) { if (e.target === modal) modal.style.display = 'none'; };

    // initialize
    showStep(1);
    phone.value = '+243';  // ensure prefix

    // ensure summary updates if user goes to step3
    window.updateSummary = updateSummary; // exposed
</script>
<!-- additional small fix: keep phone prefix on focus out (optional) -->
</body>
</html>
